name: pipeline

on: 
  push:
  deployment:
  release:
    types: [created]
  pull_request:
    types: [opened, reopened]

jobs:

  App:
    uses: filipeforattini/ff-iac-github-actions/.github/workflows/app.yml@main
    secrets: inherit
    with:
      mainBranch: main
      platforms: linux/amd64,linux/arm64
      staticAnalysis: false
      containerRegistry: ghcr.io
      nodeMatrix: '[17]'
      environmentsAsNamespaces: true



curl \
  -X POST \
  -H "Accept: application/vnd.github+json" \
  -H "Authorization: token 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" \
  https://api.github.com/repos/filipeforattini/ff-app-react/deployments \
  -d '{"ref":"main","environment":"dev","payload":"{ \"deploy\": \"migrate\" }","description":"Deploy request from hubot"}'